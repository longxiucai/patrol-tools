host: "http://172.20.43.74:32090"
step: "1m"
start: ""
end: "now"
time: "now"
output: ""
output-path: "/home/lyx/desktop/"
no-headers: false
timeout: 10
kubeconfig: /home/lyx/.config/Lens/kubeconfigs/3272e117-4859-47b7-9cd3-f260c8703907
rules:
    - name: cpu
      expr: '100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[10m])) * 100)'
    - name: mem
      expr: '(1 - ((node_memory_MemFree_bytes + node_memory_Cached_bytes) / node_memory_MemTotal_bytes)) * 100 > 40'
      recover:
        type: pod
        action: "free -h"   # delete|restart|其他shell语句，脚本
        enable: true
    - name: disk
      expr: '(1 - (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"})) * 100'
    - name: failed-pod
      expr: 'kube_pod_status_phase{phase!="Running",phase!="Succeeded"} == 1'
      recover:
        type: pod
        action: delete      # delete|restart|其他shell语句，脚本
        enable: false
    - name: pending-pod
      expr: 'kube_pod_status_phase{phase="Pending"} == 1'
      recover:
        type: pod
        action: delete      # delete|restart|其他shell语句，脚本
        enable: true
    - name : failed-service
        # expr: 'systemd_unit_state{type="service",state="failed"} == 1'
      expr: systemd_unit_state{type="service",state="failed",name="kylin-activation-check.service",pod="systemd-exporter-8vbj9"} == 1
      recover:
        type: service
        action: start       # start|restart|stop|disable|enable|其他shell语句，脚本
        enable: true
shell-rules: # 待开发
    - name: nginx-up
      command: docker ps -a |grep nginx-icbc|awk '{print $7}'
      operator: eq          # eq|gt|lt|ge|le| include（正则表达式 ？）
      value: Up             # 正则表达式 ？
      node-selector:
        - nginx
    # - name: ks-up
    #   command: curl -XGET -uadmin:$KylinSearchPassword "http://`kubectl get svc -n kcm kylinsearch-cluster-master|grep kylinsearch|awk '{print $3}'`:9200/_cluster/health"
    #   operator: include       # eq|gt|lt|ge|le| include（正则表达式 ？）
    #   value: "status":"green" # 正则表达式 ？
    #   node-selector:
    #     - master
ssh:
    user: root
    passwd: lyx@123.    # 节点password全局配置
    port: 22
hosts:
  - ips:
      - 172.20.43.74              # 使用全局password配置
      - 172.20.43.73
      - 172.20.43.75
    role: master
    ssh:
      user: root
      passwd: lyx@123.     # 覆盖全局password配置
      port: 22
  - ips:   
      - 172.20.43.76
      - 172.20.43.77
      - 172.20.43.78
    role: worker